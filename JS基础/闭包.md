### 闭包

#### 基础概念

##### 示例代码

```javascript
`use strict`
var a = 1;

function b(){
    var a = 2;
    console.log(a);
}

function c() {
    var a = 3;
    return function(){
        console.log(a);
    }
}

b();// 2
c()();// 3
```



##### 执行上下文

###### 基本概念

`执行上下文`是`JavaScript`代码运行的环境。主要有两种类型：

1. `全局执行上下文`，即当运行`js`文件时的默认环境。
2. `函数执行上下文`，即当函数被调用时，浏览器会为该函数创建一个`函数执行上下文`以供其使用。

`执行栈`是一种`后进先出`数据结构的栈，用于存储代码创建的所有执行上下文。

###### 代码分析

当示例代码被运行时，执行上下文的变化如下所示：

1. `JavaScript`引擎创建了一个`全局执行上下文`并把它压入`执行栈`。
2. 当`b`函数被调用时，创建一个`b函数执行上下文`将其压入执行栈。
3. 当`b`函数调用完成后，`b函数执行上下文`从当前执行栈弹出。
4. 当`c`函数被调用且内部匿名函数被调用时，依次创建一个`c函数执行上下文`与`匿名函数执行上下文`压入执行栈。
5. 当匿名函数执行完成后，`匿名函数执行上下文`从执行栈弹出。`c`函数执行完成之后亦然。
6. 等待所有代码都执行完成后，`全局执行上下文`从执行栈弹出。



##### 作用域对象与作用域链

###### 基本概念

当`JavaScript`在运行的时候，它需要一些空间用于存储变量，这些空间被称为作用域对象。首先，当`全局执行上下文`被创建时，会同步创建一个全局作用域对象用于存储变量，当函数被调用时，函数的本地变量会存储在一个作用域对象里。

当代码尝试去访问一个变量时，会优先从当前的作用域对象里查找这个属性，如果这个属性不存在，就会从父作用域对象中查找这个属性，直至找到该属性或再也没有父作用域对象，这个查找变量的过程中所经过的所有作用域对象称为作用域链。

###### 代码分析

1. 创建全局作用域对象，存储`a=1`变量，以及`b,c`两个`function`对象。
2. `b`函数执行，创建属于`b`函数的作用域对象，内部存储`a=2`变量，当`a`变量被调用时，优先从当前作用域对象获取变量。
3. `b`函数执行完成，`b`函数的作用域对象不被引用，可被`GC`。
4. `c`函数执行，创建属于`c`函数的作用域对象，内部存储`a=3`变量，返回`匿名函数`。
5. `匿名函数`执行，创建属于`匿名函数`的作用域对象，当`a`变量被调用时，在`匿名函数`作用域对象不存在该属性的情况下，从其父级作用域对象`c`函数的作用域对象查询该变量，并引用了`c`函数的作用域对象。此时`c`函数虽然执行完成，但是`c`函数的作用域对象被引用不能被`GC`。这个查找变量的过程称为`作用域链`。同时`匿名函数`引用了父级的作用域对象，形成闭包。
6. `匿名函数`执行完成后，`c`函数的作用域对象不被引用，可被`GC`。



##### 闭包的作用

1. 属性私有化
2. 实现模块化
3. 块级作用域

